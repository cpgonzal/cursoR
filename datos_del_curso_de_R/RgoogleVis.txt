#setwd("D:\\Docencia&Investigacion\\Asignaturas\\DatosR_Statistica_SPSS\\R_ggplot")
setwd("C:\\RLibraries")
load("dataCursoR.RData")

#cargar la librería
# http://code.google.com/p/google-motion-charts-with-r/
library(googleVis)

data.pob.municipios
#data.pob.municipios$Anio<-as.numeric(data.pob.municipios$Anio)

data.pob.capitales<-data.pob.municipios[data.pob.municipios$Indicador=="Cifras absolutas" &
                                          data.pob.municipios$CodMunicipio %in% c("ES705","ES709"),]



# Gráfico gvisMotionChart()
motion.capitales=gvisMotionChart(data.pob.capitales, idvar="Municipio", timevar="Anio", options=list(height=350, width=400))
# Display chart
plot(motion.capitales) 




# create gagdet
cat(createGoogleGadget(motion.capitales), file="motionchart.xml")
# se sube el gadget a algún repositorio y se vincula en alguna página
# https://sites.google.com/site/cpgonzal/




# Otro ejemplo
data.pob.lgom<-data.pob.municipios[data.pob.municipios$Indicador=="Cifras absolutas" &
                                          data.pob.municipios$CodMunicipio %in% c("38002","38003","38021","38036","38049","38050"),]
motion.lgom=gvisMotionChart(data.pob.lgom, idvar="Municipio", timevar="Anio", options=list(height=350, width=400))
plot(motion.lgom)





#asociar coordenadas geo-espaciales
data.coords<-read.table("datos_coordenadas_canarias.txt",header=TRUE,sep=",")
idx <- match(data.pob.capitales$CodMunicipio,data.coords$cod)
data.pob.capitales$LatLong<-paste(data.coords[idx,"latitude"],data.coords[idx,"longitude"],sep=":")




# gráfico gvisGeoMap()
map.capitales<-gvisGeoMap(data.pob.capitales[data.pob.capitales$Anio=='2012',], locationvar="LatLong", numvar="Valor",
                       options=list(region="ES", dataMode='markers',showLegend=FALSE))
# Display chart
plot(map.capitales) 




# gráfico gvisMap()
data.pob.capitales$Tip<-paste("Poblacion:",data.pob.capitales$Valor)

map.capitales<-gvisMap(data.pob.capitales[data.pob.capitales$Anio=='2012',], "LatLong", "Tip",
                       options=list(enableScrollWheel=TRUE,  mapType='terrain', useMapTypeControl=TRUE))
# Display chart
plot(map.capitales) 





# Tabla gvisTable()
table.capitales <- gvisTable(data.pob.capitales, options=list(width=800, height=470))
# Display chart
plot(table.capitales) 



table.capitales <- gvisTable(data.pob.capitales, options=list(width=800, height=470,page='enable'))
# Display chart
plot(table.capitales) 




# gráfico gvisAnnotatedTimeLine()
data.pob.capitales$Date<-as.Date(paste(data.pob.capitales$Anio,"-01-01",sep=""))


line.capitales  <- gvisAnnotatedTimeLine(data.pob.capitales, datevar="Date",
                           numvar="Valor", idvar="Municipio",    
                           date.format = "%d/%m/%Y",
                           options=list(legendPosition='newRow',displayExactValues="TRUE",
                             width=600, height=550)
                           )
# Display chart
plot(line.capitales) 




# gráfico gvisLineChart
data.pob.capitales2<-data.frame(Anio=data.pob.capitales[data.pob.capitales$Municipio==" TENERIFE","Anio"],
                                TENERIFE=data.pob.capitales[data.pob.capitales$Municipio==" TENERIFE","Valor"],
				GRAN_CANARIA=data.pob.capitales[data.pob.capitales$Municipio==" GRAN CANARIA","Valor"])


line.capitales <- gvisLineChart(data.pob.capitales2,xvar="Anio",yvar=c("TENERIFE","GRAN_CANARIA"),
                                options=list(legend='right', width=600, height=400))
plot(line.capitales)



line.capitales <- gvisLineChart(data.pob.capitales2,xvar="Anio",yvar=c("TENERIFE","GRAN_CANARIA"),
                                options=list(
                                            title="Poblacion en TF y GC", 
                                            fontName="Arial",                          
                                            titleTextStyle="{color:'red',fontSize:16}",      
hAxis="{title:'Anio', titleTextStyle:{color:'blue'}}",                           
series="[{color:'green', targetAxisIndex: 0}, {color: 'orange',targetAxisIndex:1}]",                           
vAxes="[{title:'TENERIFE',fontName: 'Times'}, {title:'GRAN_CANARIA'}]", 
width=600, 
height=400))

plot(line.capitales)





## Bar chart
bar.capitales <- gvisBarChart(data.pob.capitales2,xvar="Anio",yvar=c("TENERIFE","GRAN_CANARIA"),
                              options=list(legend='right', width=600, height=400))
plot(bar.capitales)


# otro ejemplo
data.geo.lpalma<-data.geo.municipios[data.geo.municipios$Isla=="La Palma",]
bar.lpalma <- gvisBarChart(data.geo.lpalma,xvar="Municipio",yvar=c("Superficie"),
                              options=list(legend='right', width=600, height=400))
plot(bar.lpalma)




## Column chart
col.capitales <- gvisColumnChart(data.pob.capitales2,xvar="Anio",yvar=c("TENERIFE","GRAN_CANARIA"),
                              options=list(legend='right', width=600, height=400))
plot(col.capitales)


#otro ejemplo
col.lpalma <- gvisColumnChart(data.geo.lpalma,xvar="Municipio",yvar=c("Superficie","Perímetro.municipal"),
                              options=list(legend='right', width=800, height=400,
                                           hAxis="{slantedText:true,slantedTextAngle:60}"))
plot(col.lpalma)



## Area chart
area.capitales <- gvisAreaChart(data.pob.capitales2,xvar="Anio",yvar=c("TENERIFE","GRAN_CANARIA"),
                              options=list(legend='right', width=600, height=400))
plot(area.capitales)





## Stepped Area Chart
data.pob.capitales2$Anio<-as.character(data.pob.capitales2$Anio)
data.pob.capitales2<-data.pob.capitales2[order(data.pob.capitales2$Anio),]


step.capitales <- gvisSteppedAreaChart(data.pob.capitales2,xvar="Anio",yvar=c("TENERIFE","GRAN_CANARIA"),
                                       options=list(isStacked=TRUE,  width=600, height=400))
plot(step.capitales)


# otro ejemplo
step.lpalma <- gvisSteppedAreaChart(data.geo.lpalma,xvar="Municipio",yvar=c("Superficie"),
                              options=list(legend='right', width=800, height=400,
                                           hAxis="{slantedText:true,slantedTextAngle:60}"))
plot(step.lpalma)



## crear un gráfico composite
compone.capitales <- gvisMerge(gvisMerge(bar.capitales,col.capitales, horizontal=FALSE), 
                               step.capitales, 
                              horizontal=TRUE, tableOptions="cellspacing=5")
plot(compone.capitales)


# otro ejemplo
compone.lpalma <- gvisMerge(gvisMerge(bar.lpalma,col.lpalma, horizontal=FALSE), 
                               step.lpalma, 
                              horizontal=TRUE, tableOptions="cellspacing=5")
plot(compone.lpalma)





## Scatter chart
data.pob.canarias<-data.pob.municipios[data.pob.municipios$Indicador %in% c("Cifras absolutas","Variación interanual") &
                                          data.pob.municipios$CodMunicipio %in% c("ES70"),]

data.pob.canarias2<-data.frame(CIFRAS_ABSOLUTAS=data.pob.canarias[data.pob.canarias$Indicador=="Cifras absolutas","Valor"],
				VAR_INTERANUAL=data.pob.canarias[data.pob.canarias$Indicador=="Variación interanual","Valor"])

scatter.canarias <- gvisScatterChart(data.pob.canarias2, 
                                     options=list(legend="none",
                                                  lineWidth=2, pointSize=0, 
                                                  vAxis="{title:'Variacion interanual'}",
                                                  hAxis="{title:'Poblacion absoluta'}", 
                                                  title="Comparacion de poblacion absoluta y var. inter.",                                                   
                                                  width=600, height=600))
plot(scatter.canarias)


#otro ejemplo
data.geo.lpalma2<-data.geo.lpalma[,c("Superficie","Altitud")]
scatter.lpalma <- gvisScatterChart(data.geo.lpalma2, 
                                     options=list(legend="none",
                                                  lineWidth=0, pointSize=2, 
                                                  vAxis="{title:'Altitud'}",
                                                  hAxis="{title:'Superficie'}",
                                                  width=600, height=600))
plot(scatter.lpalma)





## Bubble chart
data.pob.canarias2<-data.frame(CIFRAS_ABSOLUTAS=data.pob.canarias[data.pob.canarias$Indicador=="Cifras absolutas","Valor"],
				VAR_INTERANUAL=data.pob.canarias[data.pob.canarias$Indicador=="Variación interanual","Valor"],
                                ANIO=data.pob.canarias[data.pob.canarias$Indicador=="Variación interanual","Anio"])

bubble.canarias <- gvisBubbleChart(data.pob.canarias2, idvar="ANIO", xvar="CIFRAS_ABSOLUTAS", yvar="VAR_INTERANUAL",                                                
                           options=list( width=600, height=600))

plot(bubble.canarias)




data.pob.capitales<-data.pob.municipios[data.pob.municipios$Indicador %in% c("Cifras absolutas","Variación interanual") &
                                          data.pob.municipios$CodMunicipio %in% c("ES705","ES709") &
                                          data.pob.municipios$Anio %in% c("2010","2011","2012"),]

data.pob.capitales2<-data.frame(CIFRAS_ABSOLUTAS=data.pob.capitales[data.pob.capitales$Indicador=="Cifras absolutas","Valor"],
				VAR_INTERANUAL=data.pob.capitales[data.pob.capitales$Indicador=="Variación interanual","Valor"],
                                ANIO=data.pob.capitales[data.pob.capitales$Indicador=="Variación interanual","Anio"],
                                ISLA=data.pob.capitales[data.pob.capitales$Indicador=="Variación interanual","Municipio"])


bubble.canarias <- gvisBubbleChart(data.pob.capitales2, idvar="ISLA", xvar="CIFRAS_ABSOLUTAS", yvar="VAR_INTERANUAL", 
                           colorvar="ANIO", sizevar="VAR_INTERANUAL",                         
                           options=list( width=600, height=600))

plot(bubble.canarias)


#otro ejemplo
bubble.lpalma <- gvisBubbleChart(data.geo.lpalma, idvar="Isla", colorvar="Municipio", 
                                 xvar="Superficie", yvar="Altitud",  sizevar="Perímetro.municipal",                                              
                                 options=list( width=600, height=600, bubble="{textStyle:{color: 'none'}}"))

plot(bubble.lpalma)




## Pie chart
data.pob.canarias<-data.pob.municipios[data.pob.municipios$Indicador %in% c("Cifras absolutas") &
                                          data.pob.municipios$CodMunicipio %in% c("ES70") &
                                          data.pob.municipios$Anio %in% c("2010","2011","2012"),]

data.pob.canarias2<-data.frame(ANIO=as.character(data.pob.canarias[,"Anio"]),
                               CIFRAS_ABSOLUTAS=data.pob.canarias[,"Valor"])

pie.canarias <- gvisPieChart(data.pob.canarias2,labelvar = "ANIO", numvar = "CIFRAS_ABSOLUTAS", 
                                       options=list(width=600, height=400))
plot(pie.canarias)


# otro ejemplo
data.geo.lpalma2<-data.geo.lpalma[,c("Municipio","Superficie")]

pie.lpalma <- gvisPieChart(data.geo.lpalma2,labelvar = "Municipio", numvar = "Superficie", 
                                       options=list(width=600, height=400))
plot(pie.lpalma)






## Gauge
gauge.canarias <-  gvisGauge(data.pob.canarias2, options=list(
                                      fontSize=9,
                                      min=2000000, max=2200000, 
                                      redFrom=2000000, redTo=2100000,
                                      yellowFrom=2100000, yellowTo=2150000,
                                      greenFrom=2150000, greenTo=2200000, 
                                      width=800, height=320))
plot(gauge.canarias)




## Org chart
data.org.canarias<-data.frame(ISLA=c("CANARIAS", "LANZAROTE", "FUERTEVENTURA", "GRAN CANARIA", "TENERIFE",     
                                     "LA GOMERA", "LA PALMA", "EL HIERRO"),
                              PARENT=c(NA, "GRAN CANARIA", "GRAN CANARIA", "CANARIAS", "CANARIAS", "TENERIFE", 
                                     "TENERIFE", "TENERIFE"),
                              CODE=c("ES70","ES708","ES704","ES705","ES709","ES706","ES707","ES703") )


org.canarias <- gvisOrgChart(data.org.canarias, idvar = "ISLA", parentvar = "PARENT", tipvar="CODE", 
                               options=list(width=600, height=210,
                               size='large', allowCollapse=TRUE))
plot(org.canarias)




org.canarias <- gvisOrgChart(data.org.canarias, idvar = "ISLA", parentvar = "PARENT", tipvar="CODE", 
                               options=list(width=200, height=50,
                               size='small', allowCollapse=TRUE))

plot(org.canarias)















